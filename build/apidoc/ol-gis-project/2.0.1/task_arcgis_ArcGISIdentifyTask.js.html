<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: task/arcgis/ArcGISIdentifyTask.js</title>

    <script src="scripts/prettify.js"> </script>
    <script src="scripts/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/tomorrow.min.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: task/arcgis/ArcGISIdentifyTask.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import QueryTask from '../QueryTask';
//业务数据展示
import WellOperation from '../../../../project/js/WellOperation';
import { arcgisToGeoJSON } from '@esri/arcgis-to-geojson-utils';
import EsriJSONFormat from '../../format/arcgis/EsriJSONFormat';
import Config from '../../../config/config';

/**
 * @classdesc arcgis范围查询
 * @author ydx
 * @date 2019-04-11
 * @module task/arcgis/ArcGISIdentifyTask
 * @extends QueryTask
 */
class ArcGISIdentifyTask extends QueryTask {
    /**
     * 
     * @param {*} url 必填*
     * @param {*} params 
     * @param {map} params.map  必填*
     * @param {ArcgisExtent} params.geometry  必填*
     * @param {ArcgisExtent} params.mapExtent  必填*
     * @param {Array&lt;number>} params.layersIds  必填*
     * @param {number} params.projection  必填* '3857'
     */
    constructor(url, params) {
        super();
        this.url = url + "/identify";
        this.map = params.map;
        this.params = {};
        this.params.f = 'json';
        this.params.geometry = JSON.stringify(params.geometry);
        this.params.tolerance = params.tolerance || 10;
        this.params.returnGeometry = true;
        this.params.mapExtent = JSON.stringify(params.mapExtent);
        this.params.imageDisplay = '1920,937,96'; //width=1920,height=937,dpi=96
        this.params.geometryType = params.geometryType || 'esriGeometryEnvelope';
        this.params.layers = 'all:' + params.layersIds.toString();
        this.params.sr = params.projection || Config.mapConfig.projection.split(":")[1];
        //格式化数据
        this.identifyJSONformat = new EsriJSONFormat({ id: "identifyJSONformat" });
    };

    /**
     * @description 查询函数
     * @param {function} successCallBack 
     * @param {function} errorCallBack 
     */
    execute(successCallBack, errorCallBack) {
        var __this = this;
        __this.ajaxGetReqeust(__this.url, __this.params).then(successCallBack || __this.successCallBack.bind(this), errorCallBack || __this.errorCallBack.bind(this));
    }

    /**
     * @description 成功回调
     * @param {Features} result 
     */
    successCallBack(result) {
        var __this = this;
        var features = __this.identifyJSONformat.readFeatures(result);
        //layerId 与初始化查询要素图层id一致
        WellOperation.displayWellDataFuncs(features, __this.map, "queryFeaturesLayer");
    }

    /**
     * @description 失败回调
     * @param {error} error 
     */
    errorCallBack(error) {
        throw new Error(error);
    }

    /**
     * @description 结果转换geojson
     * @param {Features} results 
     * @returns {Geojson} geojsonData
     */
    getGeoJSONData(results) {
        var geojsonData = {
            "type": "FeatureCollection",
            "features": []
        };

        results.forEach(result => {
            geojsonData["features"].push({
                "type": "Feature",
                "properties": result["attributes"],
                "geometry": arcgisToGeoJSON(result["geometry"]),
            })
        });
        return geojsonData;
    }

    /**
     * @description 获取geometry ogc类型
     * @param {string} arcgis esriGeometryType 
     * @returns {string} 
     */
    getGoeJSONGeometryType(esriGeometryType) {
        var geometryType = "";
        switch (esriGeometryType) {
            case "esriGeometryPoint":
                geometryType = "Point";
                break;

            case "esriGeometryolyline":
                geometryType = "Point";
                break;

            case "esriGeometryPolygon":
                geometryType = "Polygon";
                break;

            case "esriGeometryMultipoint":
                geometryType = "MultiPoint";
                break;

            default:
                geometryType = "Point";
                break;
        }
        return geometryType;
    }
}

export default ArcGISIdentifyTask;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-controls_Legend_LegendControl.html">controls/Legend/LegendControl</a></li><li><a href="module-controls_overviewMap_OverviewMapControl.html">controls/overviewMap/OverviewMapControl</a></li><li><a href="module-controls_scalebar_ScaleBarControl.html">controls/scalebar/ScaleBarControl</a></li><li><a href="module-controls_switchLayer_BaseLayerSwitcherImageControl.html">controls/switchLayer/BaseLayerSwitcherImageControl</a></li><li><a href="module-controls_switchLayer_LayersSwitchControl.html">controls/switchLayer/LayersSwitchControl</a></li><li><a href="module-controls_zoomSlider_ZoomSliderControl.html">controls/zoomSlider/ZoomSliderControl</a></li><li><a href="module-format_arcgis_EsriJSONFormat.html">format/arcgis/EsriJSONFormat</a></li><li><a href="module-format_geoserver_GeoServerJSONFormat.html">format/geoserver/GeoServerJSONFormat</a></li><li><a href="module-interactions_Draw_DragBoxInteraction.html">interactions/Draw/DragBoxInteraction</a></li><li><a href="module-interactions_Draw_DragZoomInteraction.html">interactions/Draw/DragZoomInteraction</a></li><li><a href="module-interactions_Draw_measure_AreaInteraction.html">interactions/Draw/measure/AreaInteraction</a></li><li><a href="module-interactions_Draw_measure_DistanceInteraction.html">interactions/Draw/measure/DistanceInteraction</a></li><li><a href="module-interactions_SelectInteraction.html">interactions/SelectInteraction</a></li><li><a href="module-Layers_arcgis_ArcGISImageLayers.html">Layers/arcgis/ArcGISImageLayers</a></li><li><a href="module-Layers_arcgis_ArcgisLayerGroup.html">Layers/arcgis/ArcgisLayerGroup</a></li><li><a href="module-Layers_arcgis_ArcGISRestLayer.html">Layers/arcgis/ArcGISRestLayer</a></li><li><a href="module-Layers_arcgis_ArcGISTileLayers.html">Layers/arcgis/ArcGISTileLayers</a></li><li><a href="module-Layers_geoserver_GeoImageLayer.html">Layers/geoserver/GeoImageLayer</a></li><li><a href="module-Layers_geoserver_GeoLayerGroup.html">Layers/geoserver/GeoLayerGroup</a></li><li><a href="module-Layers_geoserver_GeoTileLayer.html">Layers/geoserver/GeoTileLayer</a></li><li><a href="module-Layers_GroupLayers.html">Layers/GroupLayers</a></li><li><a href="module-Layers_ImageWMSLayer.html">Layers/ImageWMSLayer</a></li><li><a href="module-Layers_vectorCharts_ExtChartLayer.html">Layers/vectorCharts/ExtChartLayer</a></li><li><a href="module-Layers_VectorLayer.html">Layers/VectorLayer</a></li><li><a href="module-Layers_WMTSLayer.html">Layers/WMTSLayer</a></li><li><a href="module-Layers_XYZLayer.html">Layers/XYZLayer</a></li><li><a href="module-ol_compenents_MapSub.html">ol/compenents/MapSub</a></li><li><a href="module-overlay_charts_echarts_BarEChartOverlay.html">overlay/charts/echarts/BarEChartOverlay</a></li><li><a href="module-overlay_charts_echarts_EChartOverlay.html">overlay/charts/echarts/EChartOverlay</a></li><li><a href="module-overlay_charts_echarts_PieEChartOverlay.html">overlay/charts/echarts/PieEChartOverlay</a></li><li><a href="module-style_IconStyle.html">style/IconStyle</a></li><li><a href="module-task_arcgis_ArcGISIdentifyTask.html">task/arcgis/ArcGISIdentifyTask</a></li><li><a href="module-task_arcgis_GeoserverIdentifyTask.html">task/arcgis/GeoserverIdentifyTask</a></li></ul><h3>Classes</h3><ul><li><a href="module-controls_Legend_LegendControl-LegendControl.html">LegendControl</a></li><li><a href="module-controls_overviewMap_OverviewMapControl-OverviewMapControl.html">OverviewMapControl</a></li><li><a href="module-controls_scalebar_ScaleBarControl-ScaleBarControl.html">ScaleBarControl</a></li><li><a href="module-controls_switchLayer_BaseLayerSwitcherImageControl-BaseLayerSwitcherImageControl.html">BaseLayerSwitcherImageControl</a></li><li><a href="module-controls_switchLayer_LayersSwitchControl-LayersSwitchControl.html">LayersSwitchControl</a></li><li><a href="module-controls_zoomSlider_ZoomSliderControl-ZoomSliderControl.html">ZoomSliderControl</a></li><li><a href="module-format_arcgis_EsriJSONFormat-EsriJSONFormat.html">EsriJSONFormat</a></li><li><a href="module-format_geoserver_GeoServerJSONFormat-GeoServerJSONFormat.html">GeoServerJSONFormat</a></li><li><a href="module-interactions_Draw_DragBoxInteraction-DragBoxInteraction.html">DragBoxInteraction</a></li><li><a href="module-interactions_Draw_DragZoomInteraction-DragZoomInteraction.html">DragZoomInteraction</a></li><li><a href="module-interactions_Draw_measure_AreaInteraction-AreaInteraction.html">AreaInteraction</a></li><li><a href="module-interactions_Draw_measure_DistanceInteraction-DistanceInteraction.html">DistanceInteraction</a></li><li><a href="module-interactions_SelectInteraction-SelectInteraction.html">SelectInteraction</a></li><li><a href="module-Layers_arcgis_ArcGISImageLayers-ArcGISImageLayers.html">ArcGISImageLayers</a></li><li><a href="module-Layers_arcgis_ArcgisLayerGroup-ArcgisLayerGroup.html">ArcgisLayerGroup</a></li><li><a href="module-Layers_arcgis_ArcGISRestLayer-ArcGISRestLayer.html">ArcGISRestLayer</a></li><li><a href="module-Layers_arcgis_ArcGISTileLayers-ArcGISTileLayers.html">ArcGISTileLayers</a></li><li><a href="module-Layers_geoserver_GeoImageLayer-GeoImageLayer.html">GeoImageLayer</a></li><li><a href="module-Layers_geoserver_GeoLayerGroup-GeoLayerGroup.html">GeoLayerGroup</a></li><li><a href="module-Layers_geoserver_GeoTileLayer-GeoTileLayer.html">GeoTileLayer</a></li><li><a href="module-Layers_GroupLayers-GroupLayers.html">GroupLayers</a></li><li><a href="module-Layers_ImageWMSLayer-ImageWMSLayer.html">ImageWMSLayer</a></li><li><a href="module-Layers_vectorCharts_ExtChartLayer-ExtChartLayer.html">ExtChartLayer</a></li><li><a href="module-Layers_VectorLayer-VectorLayer.html">VectorLayer</a></li><li><a href="module-Layers_WMTSLayer-WMTSLayer.html">WMTSLayer</a></li><li><a href="module-Layers_XYZLayer-XYZLayer.html">XYZLayer</a></li><li><a href="module-ol_compenents_MapSub-MapSub.html">MapSub</a></li><li><a href="module-overlay_charts_echarts_BarEChartOverlay-BarEChartOverlay.html">BarEChartOverlay</a></li><li><a href="module-overlay_charts_echarts_EChartOverlay-EChartOverlay.html">EChartOverlay</a></li><li><a href="module-style_IconStyle-IconStyle.html">IconStyle</a></li><li><a href="module-task_arcgis_ArcGISIdentifyTask-ArcGISIdentifyTask.html">ArcGISIdentifyTask</a></li><li><a href="module-task_arcgis_GeoserverIdentifyTask-GeoserverIdentifyTask.html">GeoserverIdentifyTask</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.2</a> on Mon May 27 2019 11:35:37 GMT+0800 (GMT+08:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
